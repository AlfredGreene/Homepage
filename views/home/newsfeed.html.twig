{% set hadNewItems = false %}
{% set showedEarlierTodayMessage = false %}
{% set hadYesterdayBefore = false %}
{% set yesterdayDate = "-1 days"|date('Y-m-d') %}
{% set isFirst = true %}

{% if addToChecklist != '' and nextPageNumber == 1 %}
    <div class="feed-list-item--state-button">
        Add "<b>{{ addToChecklist }}</b>" to checklist
    </div>
{% endif %}

{% for item in feedItems %}

    {% if not item.viewed %}
        {% set hadNewItems = true %}
    {% endif %}

    {% if item.viewed and hadNewItems and not showedEarlierTodayMessage and not isFirst %}
        <div class="feed-list--separator">
            Earlier today
        </div>
        {% set showedEarlierTodayMessage = true %}
    {% elseif item.viewed and not hadYesterdayBefore and item.dateAdded|date('Y-m-d') == yesterdayDate and not isFirst %}
        <div class="feed-list--separator">
            Yesterday
        </div>
        {% set hadYesterdayBefore = true %}
    {% endif %}

    <div class="feed-list-item js-action-feed-list-click js-action-feed-list-swipe {% if not item.viewed %}feed-list-item--state-new{% endif %} {% if item.pinned %}feed-list-item--state-pinned{% endif %}"
         data-url="{{ item.url }}" style="border-left-color:#{{ item.color }};">
        <div class="pin" data-pin-id="{{ item.id }}"></div>
        <p class="title ">{{ item.title|striptags }}</p>
        <p class="description">{{ item.description|truncate(120, true) }}</p>
    </div>

    {% set isFirst = false %}
{% endfor %}

{% if feedItems|length > 0 and nextPageNumber != 50000 %}
    <a href="/feed/page/{{ nextPageNumber }}" class="feed-list-item jscroll-next">Next page</a>
{% endif %}
